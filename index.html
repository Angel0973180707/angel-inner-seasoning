<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#3b2a1a" />
  <title>心靈調味師｜Angel Inner Seasoning</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <a class="skip" href="#main">跳到主要內容</a>

  <header class="topbar">
    <div class="brand" role="banner">
      <img class="appicon" src="icon-192.png" alt="" width="40" height="40" />
      <div class="txt">
        <div class="title">心靈調味師</div>
        <div class="sub">1 分鐘：覺察 → 暫停 → 轉念 → 行動，把心站穩。</div>
      </div>
    </div>

    <div class="row gap">
      <button id="btnVideo" class="btn ghost" type="button">影片欣賞</button>
      <button id="btnInstall" class="btn ghost" type="button" hidden>安裝</button>
    </div>
  </header>

  <main id="main" class="wrap" tabindex="-1">

    <!-- 金句輪換 -->
    <section class="card quotes" aria-label="金句輪換">
      <div class="row between">
        <div>
          <div class="h">金句輪換</div>
          <div class="p muted">需要時就看一下，不需要也沒關係。</div>
        </div>
        <label class="switch">
          <input id="quotesToggle" type="checkbox" />
          <span class="track" aria-hidden="true"></span>
          <span class="sr">開關金句輪換</span>
        </label>
      </div>

      <div id="quotesBody" class="quotesBody" hidden>
        <div class="quoteBox">
          <div id="quoteText" class="quoteText">任何時候停下來，都可以。只要舒服，就很好。</div>
          <div class="row gap">
            <button id="btnNextQuote" class="btn" type="button">換一句</button>
            <button id="btnCopyQuote" class="btn ghost" type="button">複製</button>
          </div>
        </div>

        <details class="details">
          <summary>管理金句（可新增／刪除）</summary>
          <div class="row gap">
            <input id="quoteInput" class="input" type="text" maxlength="80" placeholder="輸入一段你想留下的金句（可說出口）" />
            <button id="btnAddQuote" class="btn" type="button">新增</button>
          </div>
          <div id="quotesList" class="chips" aria-label="金句清單"></div>
        </details>
      </div>
    </section>

    <!-- 流程卡 -->
    <section class="card" aria-label="心靈調味流程">
      <div class="row between">
        <div>
          <div class="h">可走的路</div>
          <div class="p muted">不用做完也可以。你想停哪裡，就停哪裡。</div>
        </div>
        <div class="pill" id="stepPill">1/4</div>
      </div>

      <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>

      <!-- Step 1 -->
      <section class="step" data-step="1">
        <div class="kicker">心靈味覺偵測</div>
        <h2 class="stepTitle">在反應之前，先感覺此刻的心，是什麼味道。</h2>
        <div class="tags">#暫停 #斷點 #情緒急救 #自動化反應</div>

        <p class="p">
          先不要急著處理事情，也不用判斷對錯。<br />
          請你停一下，感受此刻的心。<br /><br />
          現在，你的心靈是什麼味道？
        </p>

        <div class="flavors" role="group" aria-label="選擇味道">
          <button class="flavor" data-flavor="酸" type="button"><span class="emoji">☁</span><span class="name">酸</span><span class="desc">委屈、心酸</span></button>
          <button class="flavor" data-flavor="甜" type="button"><span class="emoji">🍯</span><span class="name">甜</span><span class="desc">安心、靠近</span></button>
          <button class="flavor" data-flavor="苦" type="button"><span class="emoji">🍂</span><span class="name">苦</span><span class="desc">壓力、沉重</span></button>
          <button class="flavor" data-flavor="辣" type="button"><span class="emoji">🔥</span><span class="name">辣</span><span class="desc">憤怒、火大</span></button>
          <button class="flavor" data-flavor="鹹" type="button"><span class="emoji">🧂</span><span class="name">鹹／澀</span><span class="desc">無力、挫折</span></button>
        </div>

        <div class="box soft">
          <div class="h2">我原本會怎麼反應</div>
          <textarea id="t1_react" class="textarea" rows="3" placeholder="例如：我會提高音量、開始講道理、想立刻解決…"></textarea>

          <div class="h2">我先做一個小動作：承認我的味道</div>
          <div class="row gap">
            <div class="pill big" id="pickedFlavor">尚未選擇</div>
            <button id="btnCopyFlavorLine" class="btn ghost" type="button">複製一句</button>
          </div>
          <div id="flavorLine" class="say">「我現在有點…（先承認一下就好）」</div>
        </div>

        <div class="row between">
          <button class="btn ghost" type="button" data-action="exit">我先停在這裡</button>
          <button class="btn" type="button" data-action="next">下一步</button>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="step" data-step="2" hidden>
        <div class="kicker">30 秒斷電</div>
        <h2 class="stepTitle">在情緒全速運轉前，給大腦 30 秒重新調味。</h2>
        <div class="tags">#暫停 #斷點 #情緒急救 #自動化反應</div>

        <p class="p">
          現在，什麼都不用做，也不用想清楚。<br />
          請給大腦 30 秒。<br /><br />
          慢慢拉動滑桿，讓身體知道：你已經按下暫停。
        </p>

        <div id="sliderStage" class="sliderStage" aria-label="斷電滑桿區">
          <div class="sliderHint">
            <div class="count" id="countText">30</div>
            <div class="muted">慢慢拉到最右邊。拉到底，就完成斷電。</div>
          </div>

          <input id="powerSlider" class="slider" type="range" min="0" max="100" value="0" aria-label="斷電滑桿" />

          <div class="row between">
            <div class="pill big" id="powerState">尚未斷電</div>
            <button id="btnCopyPauseLine" class="btn ghost" type="button">複製一句</button>
          </div>
          <div id="pauseLine" class="say">「我先停 30 秒，等一下再說。」</div>

          <div class="box soft">
            <div class="h2">我現在願意做的最小停頓</div>
            <textarea id="t2_pause" class="textarea" rows="3" placeholder="例如：先閉嘴、先喝口水、先退一步、先把聲音放低…"></textarea>
          </div>

          <div id="powerDone" class="done" hidden>
            <div class="doneIcon" aria-hidden="true">✨</div>
            <div class="doneText">斷電完成。你沒有壓住情緒，你只是讓它慢下來。</div>
          </div>
        </div>

        <div class="row between">
          <button class="btn ghost" type="button" data-action="prev">上一步</button>
          <button class="btn" type="button" data-action="next">下一步</button>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="step" data-step="3" hidden>
        <div class="kicker">上善若水調味方</div>
        <h2 class="stepTitle">把剛才的情緒，轉成可以流動的說法。</h2>
        <div class="tags">#暫停 #斷點 #情緒急救 #自動化反應</div>

        <p class="p">
          現在，讓我們換一種調味方式。<br />
          水不硬碰硬，卻能穿越一切。<br />
          你不是退讓，你是在帶路。
        </p>

        <div class="box soft">
          <div class="h2">我現在選擇怎麼說</div>
          <textarea id="t3_say" class="textarea" rows="3" placeholder="把你想說的，調成『可以流動』的版本…"></textarea>

          <div class="h2">一句可說出口的替代句（依味道）</div>
          <div class="row gap">
            <button id="btnSuggestLine" class="btn" type="button">給我一句</button>
            <button id="btnCopySuggestLine" class="btn ghost" type="button">複製</button>
          </div>
          <div id="suggestLine" class="say">（你可以按「給我一句」）</div>
        </div>

        <div class="row between">
          <button class="btn ghost" type="button" data-action="prev">上一步</button>
          <button class="btn" type="button" data-action="next">下一步</button>
        </div>
      </section>

      <!-- Step 4 -->
      <section class="step" data-step="4" hidden>
        <div class="kicker">甜美存檔</div>
        <h2 class="stepTitle">把這一次的穩定，存成下次用得到的力量。</h2>
        <div class="tags">#暫停 #斷點 #情緒急救 #自動化反應</div>

        <p class="p">
          恭喜你，你完成了一次心靈調味。<br />
          不是因為事情完美，而是你沒有被捲走。<br /><br />
          請寫下一句：你此刻想感謝的話。哪怕很小，它都會被保存。
        </p>

        <div class="box soft">
          <div class="h2">我此刻想感謝的一句話</div>
          <textarea id="t4_thanks" class="textarea" rows="3" placeholder="例如：謝謝我願意停一下；謝謝我沒有用力傷人；謝謝你還在…"></textarea>

          <div class="h2">一句可說出口的收尾句</div>
          <div class="row gap">
            <button id="btnCopyCloseLine" class="btn ghost" type="button">複製</button>
            <button id="btnSave" class="btn" type="button">存檔</button>
          </div>
          <div id="closeLine" class="say">「我先把心站穩，等我穩了再回來。」</div>

          <div id="saveResult" class="saveResult" role="status" aria-live="polite"></div>
        </div>

        <div class="row between">
          <a class="btn ghost" href="https://angel0973180707.github.io/angel-happy-paw/" target="_blank" rel="noopener">一鍵回概念館</a>
          <button class="btn" type="button" data-action="restart">再來一次</button>
        </div>

        <details class="details">
          <summary>查看我的甜美存檔</summary>
          <div id="archiveList" class="archive"></div>
        </details>

        <div class="row gap">
          <a id="btnFeedback" class="btn ghost" href="https://forms.gle/rHL77QaLRnw3s4mC8" target="_blank" rel="noopener">回饋表單</a>
          <button id="btnCopyFeedbackLink" class="btn ghost" type="button">複製表單連結</button>
        </div>
      </section>

    </section>

    <!-- 說明頁 -->
    <section class="card" aria-label="說明與安裝">
      <div class="h">說明</div>
      <p class="p">
        這不是用來解決問題的工具。<br />
        這是一個「可暫停、可回來、可再選」的小空間。<br /><br />
        當你卡住、亂掉、反應太快，先不用變好，先不用說清楚。<br />
        你只要做一件事：把心站穩。<br /><br />
        你可以每天練習，也可以在現場急救。<br />
        不用做完也沒關係。你想停哪裡，就停哪裡。
      </p>

      <div class="h2">使用方式（3 行內）</div>
      <ol class="ol">
        <li>選一個味道：先承認此刻的心。</li>
        <li>拉動 30 秒斷電：讓身體知道你按下暫停。</li>
        <li>拿一句可說出口的話：把關係慢慢甜回來。</li>
      </ol>

      <div class="h2">安裝到桌面（PWA）</div>
      <p class="p">
        1) 先用瀏覽器打開這個工具（不要用內建 App 瀏覽器）。<br />
        2) 如果你是從訊息裡點開：請先「複製網址貼到瀏覽器」再開啟。<br />
        3) iPhone：分享 → 加到主畫面。Android：右上角選單 → 安裝應用程式。<br />
        4) 之後就能像 App 一樣，點一下就進來。
      </p>

      <div class="row gap">
        <a class="btn ghost" href="https://angel0973180707.github.io/angel-happy-paw/" target="_blank" rel="noopener">回概念館</a>
        <button id="btnScrollTop" class="btn" type="button">回到最上面</button>
      </div>

      <div class="p muted tiny">版本：<span class="mono">v1.0.3</span></div>
    </section>

  </main>

  <footer class="footer">
    <div class="row between">
      <a class="link" href="https://angel0973180707.github.io/angel-happy-paw/" target="_blank" rel="noopener">幸福教養概念館</a>
      <button id="btnReset" class="link" type="button">重設此工具</button>
    </div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="app.js"></script>
</body>
</html>
